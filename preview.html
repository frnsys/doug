<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        html, body {
            background: #000;
            margin: 0;
            padding: 0;
        }
    </style>
    <title>preview</title>
</head>

<body>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.6/p5.js"></script>
<script>
var drawScale = 1,
    fps = 60,
    file = location.hash.substring(1) || 'hi.json',
    draw_data, width, height, last_point;

function setup() {
    width = window.innerWidth;
    height = window.innerHeight;
    createCanvas(width, height);
    $.getJSON('json/' + file, {}, function(data) {
        draw_data = data;
    });
    stroke(255);
    frameRate(fps);
}

function step(d) {
    return {
        x: (d[0] * drawScale),
        y: (d[1] * drawScale),
        stroke_end: d[2]
    }
}

function draw() {
    if (draw_data && draw_data.length > 0) {
        if (!last_point) {
            last_point = {x: width/2, y: height/2};
        }
        var stp = step(draw_data.shift());
        var next_point = {
            x: last_point.x + stp.x,
            y: last_point.y + stp.y
        };
        if (stp.stroke_end === 0) {
            line(last_point.x, last_point.y, next_point.x, next_point.y);
        }
        last_point = next_point;
    }
}

</script>
</body>
</html>
